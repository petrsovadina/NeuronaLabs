groups:
- name: backend_alerts
  rules:
  - alert: BackendHighCPUUsage
    expr: process_cpu_usage{job="backend"} > 0.8
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "Backend High CPU Usage"
      description: "Backend service is using more than 80% CPU for 5 minutes"

  - alert: BackendHighMemoryUsage
    expr: process_memory_usage{job="backend"} > 0.9
    for: 5m
    labels:
      severity: critical
    annotations:
      summary: "Backend High Memory Usage"
      description: "Backend service is using more than 90% memory for 5 minutes"

- name: database_alerts
  rules:
  - alert: PostgresHighConnections
    expr: pg_stat_activity_count{job="postgres"} > 50
    for: 10m
    labels:
      severity: warning
    annotations:
      summary: "High PostgreSQL Connections"
      description: "PostgreSQL has more than 50 active connections for 10 minutes"

  - alert: PostgresDiskSpaceLow
    expr: pg_database_size_bytes{job="postgres"} / pg_database_size_bytes_max{job="postgres"} > 0.9
    for: 15m
    labels:
      severity: critical
    annotations:
      summary: "PostgreSQL Disk Space Low"
      description: "Database disk space usage is over 90% for 15 minutes"

- name: redis_alerts
  rules:
  - alert: RedisHighMemoryUsage
    expr: redis_memory_used_bytes{job="redis"} / redis_memory_max_bytes{job="redis"} > 0.8
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "Redis High Memory Usage"
      description: "Redis is using more than 80% of available memory for 5 minutes"

- name: system_alerts
  rules:
  - alert: HostHighCPULoad
    expr: node_load1{job="node_exporter"} > 4
    for: 10m
    labels:
      severity: warning
    annotations:
      summary: "High Host CPU Load"
      description: "Host CPU load is above 4 for 10 minutes"

  - alert: HostHighMemoryUsage
    expr: node_memory_MemAvailable_bytes{job="node_exporter"} / node_memory_MemTotal_bytes{job="node_exporter"} < 0.1
    for: 10m
    labels:
      severity: critical
    annotations:
      summary: "Low Host Memory Available"
      description: "Less than 10% memory available for 10 minutes"
